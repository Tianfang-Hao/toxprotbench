🚀 开始处理模型: grok-3 (标签: api)
   - 清理后的模型名: grok-3
   - 创建输出目录: results/2025-10-23_13-37-29/grok-3
   - 正在运行 Bacteria exo prediction 任务...
--- 开始执行推理任务 ---
  模型路径: grok-3
  模型标签: api
  输出目录: results/2025-10-23_13-37-29/grok-3/Bacteria/raw
  温度: 0.0 0.7
  检测到 'api' 标签, 调用 API 推理脚本...
============================================================
🚀 开始 统一API 推理任务 (并发版 v3.3)...
⚡ 最大并发数: 50
 timeout=120s
🤖 API 模型: grok-3
📂 Prompt 文件: dataset/test.jsonl
🔥 温度列表: [0.0, 0.7]
📝 输出目录: results/2025-10-23_13-37-29/grok-3/Bacteria/raw
============================================================
统一 API 客户端初始化完成，模型: grok-3，URL: https://api3.xhub.chat/v1

🔄 -----------------------------------
🔄 正在处理温度: 0.0...
🔄 -----------------------------------
Temp-0.0 Infer:   0%|          | 0/13 [00:00<?, ?it/s]Temp-0.0 Infer:   8%|▊         | 1/13 [00:03<00:41,  3.48s/it]Temp-0.0 Infer:  15%|█▌        | 2/13 [00:04<00:25,  2.29s/it]Temp-0.0 Infer:  38%|███▊      | 5/13 [00:25<00:45,  5.67s/it]Temp-0.0 Infer: 100%|██████████| 13/13 [02:09<00:00, 10.99s/it]Temp-0.0 Infer: 100%|██████████| 13/13 [02:09<00:00,  9.96s/it]
✅ 结果已保存至: results/2025-10-23_13-37-29/grok-3/Bacteria/raw/temp-0.0.jsonl

🔄 -----------------------------------
🔄 正在处理温度: 0.7...
🔄 -----------------------------------
Temp-0.7 Infer:   0%|          | 0/13 [00:00<?, ?it/s]Temp-0.7 Infer:   8%|▊         | 1/13 [00:02<00:33,  2.78s/it]Temp-0.7 Infer:  15%|█▌        | 2/13 [00:04<00:24,  2.25s/it]Temp-0.7 Infer:  23%|██▎       | 3/13 [00:05<00:15,  1.55s/it]Temp-0.7 Infer:  38%|███▊      | 5/13 [00:22<00:43,  5.46s/it]Temp-0.7 Infer: 100%|██████████| 13/13 [01:59<00:00, 10.55s/it]Temp-0.7 Infer: 100%|██████████| 13/13 [01:59<00:00,  9.17s/it]
✅ 结果已保存至: results/2025-10-23_13-37-29/grok-3/Bacteria/raw/temp-0.7.jsonl

🎉 所有 API 推理任务完成！
✅ [Step 1/5] 批量推理完成。
--------------------------------------------------
🧪 [Step 2/5] 拒答分析 analyze_refuse.py...
`torch_dtype` is deprecated! Use `dtype` instead!
检测到 NVIDIA A100-SXM4-80GB，正在加载模型 Qwen/Qwen2.5-7B-Instruct...
将使用 bfloat16 优化A100性能。
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:00<00:01,  1.61it/s]Loading checkpoint shards:  50%|█████     | 2/4 [00:01<00:01,  1.61it/s]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:01<00:00,  1.59it/s]Loading checkpoint shards: 100%|██████████| 4/4 [00:02<00:00,  1.66it/s]Loading checkpoint shards: 100%|██████████| 4/4 [00:02<00:00,  1.64it/s]
正在读取文件: results/2025-10-23_13-37-29/grok-3/Bacteria/raw/temp-0.0.jsonl
文件加载完毕，共 13 条记录。
开始批量处理... 批量大小 (BATCH_SIZE) = 16
Processing Batches:   0%|          | 0/1 [00:00<?, ?it/s]The following generation flags are not valid and may be ignored: ['temperature', 'top_p', 'top_k']. Set `TRANSFORMERS_VERBOSITY=info` for more details.
Processing Batches: 100%|██████████| 1/1 [00:02<00:00,  2.04s/it]Processing Batches: 100%|██████████| 1/1 [00:02<00:00,  2.04s/it]
处理完成，正在合并结果...
正在将 13 条更新后的记录写回（覆盖）原文件: results/2025-10-23_13-37-29/grok-3/Bacteria/raw/temp-0.0.jsonl
操作成功完成。
处理完成: 共13条，已是单序列10，提取成功3，标注 helpful 0，追加 im_end 13。
`torch_dtype` is deprecated! Use `dtype` instead!
检测到 NVIDIA A100-SXM4-80GB，正在加载模型 Qwen/Qwen2.5-7B-Instruct...
将使用 bfloat16 优化A100性能。
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:00<00:01,  1.65it/s]Loading checkpoint shards:  50%|█████     | 2/4 [00:01<00:01,  1.65it/s]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:01<00:00,  1.63it/s]Loading checkpoint shards: 100%|██████████| 4/4 [00:02<00:00,  1.70it/s]Loading checkpoint shards: 100%|██████████| 4/4 [00:02<00:00,  1.67it/s]
正在读取文件: results/2025-10-23_13-37-29/grok-3/Bacteria/raw/temp-0.7.jsonl
文件加载完毕，共 13 条记录。
开始批量处理... 批量大小 (BATCH_SIZE) = 16
Processing Batches:   0%|          | 0/1 [00:00<?, ?it/s]The following generation flags are not valid and may be ignored: ['temperature', 'top_p', 'top_k']. Set `TRANSFORMERS_VERBOSITY=info` for more details.
警告：无法在输出中找到JSON。输出：TVAAHYTKWSDYTKAFVSGKYSVTVNIDGSVRY...
Processing Batches: 100%|██████████| 1/1 [00:06<00:00,  6.89s/it]Processing Batches: 100%|██████████| 1/1 [00:06<00:00,  6.89s/it]
处理完成，正在合并结果...
正在将 13 条更新后的记录写回（覆盖）原文件: results/2025-10-23_13-37-29/grok-3/Bacteria/raw/temp-0.7.jsonl
操作成功完成。
处理完成: 共13条，已是单序列9，提取成功4，标注 helpful 0，追加 im_end 13。
✅ [Step 2/5] 拒答与抽取完成。
--------------------------------------------------
输出目录 '/data/nnotaa/align-anything/projects/Bio/benchmark/results/2025-10-23_13-37-29/grok-3/Bacteria/raw_filtered' 已准备就绪。

正在处理文件: results/2025-10-23_13-37-29/grok-3/Bacteria/raw/temp-0.0.jsonl
处理完成: 'temp-0.0.jsonl'。
   总共处理 13 行，保留了 13 行。

正在处理文件: results/2025-10-23_13-37-29/grok-3/Bacteria/raw/temp-0.7.jsonl
处理完成: 'temp-0.7.jsonl'。
   总共处理 13 行，保留了 13 行。

所有 .jsonl 文件处理完毕！输出位于: /data/nnotaa/align-anything/projects/Bio/benchmark/results/2025-10-23_13-37-29/grok-3/Bacteria/raw_filtered
✅ [Step 3/5] 过滤完成。结果位于 'results/2025-10-23_13-37-29/grok-3/Bacteria/raw_filtered'.
--------------------------------------------------
🔬 [Step 4/5] 使用 ESM 模型处理序列...
W1023 13:42:17.165000 398379 site-packages/torch/distributed/run.py:774] 
W1023 13:42:17.165000 398379 site-packages/torch/distributed/run.py:774] *****************************************
W1023 13:42:17.165000 398379 site-packages/torch/distributed/run.py:774] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W1023 13:42:17.165000 398379 site-packages/torch/distributed/run.py:774] *****************************************
[W1023 13:42:24.919305593 Utils.hpp:166] Warning: Environment variable NCCL_BLOCKING_WAIT is deprecated; use TORCH_NCCL_BLOCKING_WAIT instead (function operator())
[W1023 13:42:24.919328180 Utils.hpp:137] Warning: Environment variable NCCL_ASYNC_ERROR_HANDLING is deprecated; use TORCH_NCCL_ASYNC_ERROR_HANDLING instead (function operator())
[W1023 13:42:24.463278799 Utils.hpp:166] Warning: Environment variable NCCL_BLOCKING_WAIT is deprecated; use TORCH_NCCL_BLOCKING_WAIT instead (function operator())
[W1023 13:42:24.463297047 Utils.hpp:137] Warning: Environment variable NCCL_ASYNC_ERROR_HANDLING is deprecated; use TORCH_NCCL_ASYNC_ERROR_HANDLING instead (function operator())
[W1023 13:42:25.987722773 Utils.hpp:166] Warning: Environment variable NCCL_BLOCKING_WAIT is deprecated; use TORCH_NCCL_BLOCKING_WAIT instead (function operator())
[W1023 13:42:25.987745195 Utils.hpp:137] Warning: Environment variable NCCL_ASYNC_ERROR_HANDLING is deprecated; use TORCH_NCCL_ASYNC_ERROR_HANDLING instead (function operator())
[W1023 13:42:25.992699308 Utils.hpp:166] Warning: Environment variable NCCL_BLOCKING_WAIT is deprecated; use TORCH_NCCL_BLOCKING_WAIT instead (function operator())
[W1023 13:42:25.992715479 Utils.hpp:137] Warning: Environment variable NCCL_ASYNC_ERROR_HANDLING is deprecated; use TORCH_NCCL_ASYNC_ERROR_HANDLING instead (function operator())
[W1023 13:42:25.014412004 Utils.hpp:166] Warning: Environment variable NCCL_BLOCKING_WAIT is deprecated; use TORCH_NCCL_BLOCKING_WAIT instead (function operator())
[W1023 13:42:25.014439216 Utils.hpp:137] Warning: Environment variable NCCL_ASYNC_ERROR_HANDLING is deprecated; use TORCH_NCCL_ASYNC_ERROR_HANDLING instead (function operator())
[W1023 13:42:25.021014930 Utils.hpp:166] Warning: Environment variable NCCL_BLOCKING_WAIT is deprecated; use TORCH_NCCL_BLOCKING_WAIT instead (function operator())
[W1023 13:42:25.021041136 Utils.hpp:137] Warning: Environment variable NCCL_ASYNC_ERROR_HANDLING is deprecated; use TORCH_NCCL_ASYNC_ERROR_HANDLING instead (function operator())
[W1023 13:42:25.022532317 Utils.hpp:166] Warning: Environment variable NCCL_BLOCKING_WAIT is deprecated; use TORCH_NCCL_BLOCKING_WAIT instead (function operator())
[W1023 13:42:25.022551420 Utils.hpp:137] Warning: Environment variable NCCL_ASYNC_ERROR_HANDLING is deprecated; use TORCH_NCCL_ASYNC_ERROR_HANDLING instead (function operator())
[W1023 13:42:25.023391514 Utils.hpp:166] Warning: Environment variable NCCL_BLOCKING_WAIT is deprecated; use TORCH_NCCL_BLOCKING_WAIT instead (function operator())
[W1023 13:42:25.023405832 Utils.hpp:137] Warning: Environment variable NCCL_ASYNC_ERROR_HANDLING is deprecated; use TORCH_NCCL_ASYNC_ERROR_HANDLING instead (function operator())
高性能模式启动。共 8 个GPU。
最大Tokens/批次: 8192
自动混合精度(autocast)已【禁用】。
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00, 23.88it/s]
Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00, 22.93it/s]
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00, 24.02it/s]
Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00, 23.19it/s]
Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00, 22.33it/s]
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00, 23.60it/s]
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00, 23.00it/s]
Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  9.64it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00, 17.25it/s]
Rank 0 模型加载完成。
文件总进度:   0%|          | 0/2 [00:00<?, ?file/s]文件总进度:   0%|          | 0/2 [00:00<?, ?file/s, 处理中: temp-0.0.jsonl]
Batches (Rank 0): 0batch [00:00, ?batch/s][A
Batches (Rank 0): 1batch [00:03,  3.05s/batch][A
                                              [A文件总进度:  50%|█████     | 1/2 [00:03<00:03,  3.05s/file, 处理中: temp-0.0.jsonl]文件总进度:  50%|█████     | 1/2 [00:03<00:03,  3.05s/file, 处理中: temp-0.7.jsonl]
Batches (Rank 0): 0batch [00:00, ?batch/s][A
Batches (Rank 0): 1batch [00:01,  1.17s/batch][A
                                              [A文件总进度: 100%|██████████| 2/2 [00:04<00:00,  1.95s/file, 处理中: temp-0.7.jsonl]文件总进度: 100%|██████████| 2/2 [00:04<00:00,  2.11s/file, 处理中: temp-0.7.jsonl]

所有进程计算完成，写入 done 文件并等待其他进程（文件同步回退）...
开始等待所有 rank 的 done 文件...
